include details

mixin playerName(participant) 
	.name&attributes(attributes) #{participant.player.name}	

mixin playerShip(participant)
	.ship&attributes(attributes)
		| #{participant.ship.label}


- 
	const rows = Math.max(allies.length, enemies.length);
	const primary = options?.primary === "ship" ? 'playerShip' : 'playerName';
	const secondary = options?.primary === "ship" ? 'playerName' : 'playerShip';
- 
	function winrateClass(wr) {
		wr *= 100;
		if (0 < wr && wr < 45)
			return 'bad';
		else if (45 <= wr && wr < 49)
			return 'belowaverage';
		else if (49 <= wr && wr < 52)			
			return 'average';
		else if (52 <= wr  && wr < 54)
			return 'good';
		else if (54 <= wr && wr < 56)
			return 'verygood';
		else if (56 <= wr && wr < 60)
			return 'great';
		else if (60 <= wr && wr < 65)
			return 'unicum';
		else if (65 <= wr)
			return 'superunicum';
	}

table
	colgroup
		col.ally.name
		col.ally.winrate
		col.enemy.winrate
		col.enemy.name
	- for (let i = 0; i < rows; i++) {
		- const ally = allies[i];
		- const enemy = enemies[i];
		tr
			if ally.player
				td.ally(class=ally.player.name === player.name ? 'player' : '', 
					class=ally.ship.class.toLowerCase(),
					data-details=ally.player.name)
					//- +#{}: Dynamically determine mixin name and call it
					+#{primary}(ally).primary
					//- +#{}: Dynamically determine mixin name and call it
					+#{secondary}(ally).secondary
				td(data-details=ally.player.name)
					if ally.player.bot
						.notification Bot
					else if ally.player.hidden
						.notification private
					else
						.winrate(class=winrateClass(ally.player.winrate)) 
							| #{(100 * ally.player.winrate).toFixed(1)} 
							span.unit %
						.battles 
							| #{ally.player.battles} 
							span.unit battles
						aside.details.ally(
							class=ally.player.name === player.name ? 'player' : '',
							class=ally.ship.class.toLowerCase(),
							data-details-for=ally.player.name)
							+details(ally)
			else
				- console.error(`No result for ally #${ally.name}`);
				td(colspan=2, style='font-size: 75%; color: red; white-space: normal;')
					| There was an error getting data for ally #{ally.name}
			if enemy.player
				td(data-details=enemy.player.name)
					if enemy.player.bot
						.notification Bot
					else if enemy.player.hidden
						.notification private
					else
						.winrate(class=winrateClass(enemy.player.winrate))
							| #{(100 * enemy.player.winrate).toFixed(1)}
							span.unit %
						.battles 
							| #{enemy.player.battles} 
							span.unit battles
						aside.details.enemy(class=ally.ship.class.toLowerCase(), data-details-for=enemy.player.name)
							+details(enemy)
				td.enemy(class=enemy.ship.class.toLowerCase(), 
					data-details=enemy.player.name)
					//- +#{}: Dynamically determine mixin name and call it
					+#{primary}(enemy).primary
					//- +#{}: Dynamically determine mixin name and call it
					+#{secondary}(enemy).secondary
			else
				- console.error(`No result for enemy #${enemy.name}`);
				td(colspan=2, style='font-size: 75%; color: red; white-space: normal;')
					| There was an error getting data for enemy #{enemy.name}
	- }		